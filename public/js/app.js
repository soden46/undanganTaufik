const storage=e=>{localStorage.getItem(e)||localStorage.setItem(e,JSON.stringify({}));let t=(t=null)=>{let a=JSON.parse(localStorage.getItem(e));return t?a[t]:a},a=(a,n)=>{let l=t();l[a]=n,localStorage.setItem(e,JSON.stringify(l))},n=a=>{let n=t();delete n[a],localStorage.setItem(e,JSON.stringify(n))},l=e=>Object.keys(t()).includes(e);return{get:t,set:a,unset:n,has:l}},request=(e,t)=>{let a=document.querySelector("body").getAttribute("data-url"),n={method:e.toUpperCase(),headers:{Accept:"application/json","Content-Type":"application/json"}};return"/"==a.slice(-1)&&"/taufik-citra"==a.slice(-1)&&(a=a.slice(0,-1)),{then:async(...e)=>fetch(a+t,n).then(e=>e.json()).then(e=>{if(null!==e.error)throw e.error[0];return e}).then(...e),token(e){return n.headers.Authorization="Bearer "+e,this},body(e){return n.body=JSON.stringify(e),this}}},util=(()=>{let e=e=>{let t=document.getElementById(e),a=parseInt(t.style.opacity),n=null;n=setInterval(()=>{if(a>=0)t.style.opacity=a.toString(),a-=.025;else{clearInterval(n),n=null,t.remove();return}},10)},t=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),a=(e,t="Tersalin",a=1500)=>{navigator.clipboard.writeText(e.getAttribute("data-nomer"));let n=e.innerHTML;e.innerHTML=t,e.disabled=!0;let l=null;l=setTimeout(()=>{e.innerHTML=n,e.disabled=!1,e.focus(),clearTimeout(l),l=null},a)},n=()=>{let e=new Date(document.getElementById("tampilan-waktu").getAttribute("data-waktu").replace(" ","T")).getTime();setInterval(()=>{let t=Math.abs(e-new Date().getTime());document.getElementById("hari").innerText=Math.floor(t/864e5),document.getElementById("jam").innerText=Math.floor(t%864e5/36e5),document.getElementById("menit").innerText=Math.floor(t%36e5/6e4),document.getElementById("detik").innerText=Math.floor(t%6e4/1e3)},1e3)},l=e=>{"true"!==e.getAttribute("data-status")?(e.setAttribute("data-status","true"),audio.play(),e.innerHTML='<i class="fa-solid fa-circle-pause spin-button"></i>'):(e.setAttribute("data-status","false"),audio.pause(),e.innerHTML='<i class="fa-solid fa-circle-play"></i>')},s=e=>{document.getElementById("show-modal-image").src=e.src,new bootstrap.Modal("#modal-image").show()},i=()=>{let e=Date.now()+15e3,t=["#FFC0CB","#FF1493","#C71585"],a=(e,t)=>Math.random()*(t-e)+e,n=confetti.shapeFromPath({path:"M167 72c19,-38 37,-56 75,-56 42,0 76,33 76,75 0,76 -76,151 -151,227 -76,-76 -151,-151 -151,-227 0,-42 33,-75 75,-75 38,0 57,18 76,56z",matrix:[.03333333333333333,0,0,.03333333333333333,-5.566666666666666,-5.533333333333333]});!function l(){let s=e-Date.now();t.forEach(e=>{confetti({particleCount:1,startVelocity:0,ticks:Math.max(50,75*(s/15e3)),origin:{x:Math.random(),y:Math.abs(Math.random()-s/15e3)},zIndex:1057,colors:[e],shapes:[n],drift:a(-.5,.5),gravity:a(.5,1),scalar:a(.5,1)})}),s>0&&requestAnimationFrame(l)}()},d=async t=>{t.disabled=!0,document.querySelector("body").style.overflowY="scroll",AOS.init(),audio.play(),localStorage.getItem("alertClosed")&&(document.getElementById("alertDiv").style.display="none"),e("welcome"),document.getElementById("tombol-musik").style.display="block",n(),confetti({origin:{y:.9},zIndex:1057}),await session.check(),i()},r=()=>{e("loading"),window.scrollTo(0,0)},o=(e,t,a)=>{let n=null;n=setTimeout(()=>{e.classList.add(a),n=null},t)};return{buka:d,modal:s,music:l,salin:a,escapeHtml:t,show:r,animate:o}})(),progress=(()=>{let e=document.querySelectorAll("img"),t=document.getElementById("progress-info"),a=document.getElementById("bar"),n=e.length,l=0,s=()=>{l+=1,a.style.width=Math.min(l/n*100,100).toString()+"%",t.innerText=`Loading assets (${l}/${n}) [${parseInt(a.style.width).toFixed(0)}%]`,l==n&&util.show()};e.forEach(e=>{e.complete&&0!==e.naturalWidth?s():e.addEventListener("load",()=>s())})})(),audio=(()=>{let e=null,t=()=>(e||((e=new Audio).src=document.getElementById("tombol-musik").getAttribute("data-url"),e.load(),e.currentTime=0,e.autoplay=!0,e.muted=!1,e.loop=!0,e.volume=1),e);return{play:()=>t().play(),pause:()=>t().pause()}})(),pagination=(()=>{let e=0,t=0,a=document.getElementById("page"),n=document.getElementById("previous"),l=document.getElementById("next"),s=()=>{n.classList.add("disabled")},i=()=>{l.classList.add("disabled")},d=async e=>{let t=e.innerHTML;e.disabled=!0,e.innerHTML='<span class="spinner-border spinner-border-sm me-1"></span>Loading...',await comment.ucapan(),document.getElementById("daftar-ucapan").scrollIntoView({behavior:"smooth"}),e.disabled=!1,e.innerHTML=t};return{getPer:()=>10,getNext:()=>e,async reset(){e=0,t=0,a.innerText=1,l.classList.remove("disabled"),await comment.ucapan(),s()},setResultData(e){(t=e)<10&&i()},async previous(t){e<0?s():(e-=10,i(),await d(t),a.innerText=parseInt(a.innerText)-1,l.classList.remove("disabled"),e<=0&&s())},async next(l){t<10?i():(e+=10,s(),await d(l),a.innerText=parseInt(a.innerText)+1,n.classList.remove("disabled"))}}})(),session=(()=>{let e=document.querySelector("body"),t=async()=>{await request("POST","/api/session").body({email:e.getAttribute("data-email"),password:e.getAttribute("data-password")}).then(e=>{200==e.code&&(localStorage.removeItem("token"),localStorage.setItem("token",e.data.token),comment.ucapan())}).catch(e=>{alert(`Terdapat kesalahan: ${e}`),window.location.reload()})},a=async()=>{let e=localStorage.getItem("token");if(e){let a=JSON.parse(atob(e.split(".")[1]));a.exp<new Date().getTime()/1e3||!a.iss.includes(new URL(window.location.href).host)?await t():await comment.ucapan()}else await t()};return{check:a}})(),like=(()=>{let e=storage("likes"),t=async t=>{let a=localStorage.getItem("token"),n=t.getAttribute("data-uuid");if(!a){alert("Terdapat kesalahan, token kosong !"),window.location.reload();return}let l=t.firstElementChild.lastElementChild,s=t.firstElementChild.firstElementChild;t.disabled=!0,s.innerText="Loading..",e.has(n)?await request("PATCH","/api/comment/"+e.get(n)).token(a).then(t=>{t.data.status&&(e.unset(n),l.classList.remove("fa-solid","text-danger"),l.classList.add("fa-regular"),s.setAttribute("data-suka",(parseInt(s.getAttribute("data-suka"))-1).toString()))}).catch(e=>{alert(`Terdapat kesalahan: ${e}`)}):await request("POST","/api/comment/"+n).token(a).then(t=>{201==t.code&&(e.set(n,t.data.uuid),l.classList.remove("fa-regular"),l.classList.add("fa-solid","text-danger"),s.setAttribute("data-suka",(parseInt(s.getAttribute("data-suka"))+1).toString()))}).catch(e=>{alert(`Terdapat kesalahan: ${e}`)}),s.innerText=s.getAttribute("data-suka")+" suka",t.disabled=!1};return{like:t}})(),comment=(()=>{let e=document.getElementById("batal"),t=document.getElementById("balas"),a=document.getElementById("ubah"),n=document.getElementById("kirim"),l=document.getElementById("form-kehadiran"),s=document.getElementById("form-nama"),i=document.getElementById("form-pesan"),d=storage("owns"),r=storage("likes"),o='<span class="spinner-border spinner-border-sm me-1"></span>Loading...',c=null,u=e=>e.replace(/\*(?=\S)(.*?)(?<!\s)\*/s,'<strong class="text-dark">$1</strong>').replace(/\_(?=\S)(.*?)(?<!\s)\_/s,'<em class="text-dark">$1</em>').replace(/\~(?=\S)(.*?)(?<!\s)\~/s,'<del class="text-dark">$1</del>').replace(/\`\`\`(?=\S)(.*?)(?<!\s)\`\`\`/s,'<code class="font-monospace text-dark">$1</code>'),m=()=>{e.style.display="none",t.style.display="none",a.style.display="none",n.style.display="block",document.getElementById("label-kehadiran").style.display="block",document.getElementById("balasan").innerHTML=null,l.style.display="block",s.value=null,l.value=0,i.value=null,s.disabled=!1,l.disabled=!1,i.disabled=!1},p=async()=>{let e=s.value,t=parseInt(l.value),a=i.value,r=localStorage.getItem("token")??"";if(0==r.length){alert("Terdapat kesalahan, token kosong !"),window.location.reload();return}if(0==e.length){alert("nama tidak boleh kosong");return}if(e.length>=35){alert("panjangan nama maksimal 35");return}if(0==t){alert("silahkan pilih kehadiran");return}if(0==a.length){alert("pesan tidak boleh kosong");return}s.disabled=!0,l.disabled=!0,i.disabled=!0,n.disabled=!0;let c=n.innerHTML;n.innerHTML=o;let u=!1;await request("POST","/api/comment").token(r).body({nama:e,hadir:1==t,komentar:a}).then(e=>{201==e.code&&(d.set(e.data.uuid,e.data.own),u=!0)}).catch(e=>{alert(`Terdapat kesalahan: ${e}`)}),u&&(await pagination.reset(),document.getElementById("daftar-ucapan").scrollIntoView({behavior:"smooth"}),m()),n.disabled=!1,n.innerHTML=c,s.disabled=!1,l.disabled=!1,i.disabled=!1},g=async a=>{m(),a.disabled=!0;let s=a.innerText;a.innerText="Loading...";let i=a.getAttribute("data-uuid"),d=localStorage.getItem("token")??"";if(0==d.length){alert("Terdapat kesalahan, token kosong !"),window.location.reload();return}document.getElementById("balasan").innerHTML=k(1),l.style.display="none",document.getElementById("label-kehadiran").style.display="none",await request("GET","/api/comment/"+i).token(d).then(a=>{200==a.code&&(n.style.display="none",e.style.display="block",t.style.display="block",c=i,document.getElementById("balasan").innerHTML=`
                    <div class="my-3">
                        <h6>Balasan</h6>
                        <div id="id-balasan" data-uuid="${i}" class="card-body bg-light shadow p-3 rounded-4">
                            <div class="d-flex flex-wrap justify-content-between align-items-center">
                                <p class="text-dark text-truncate m-0 p-0" style="font-size: 0.95rem;">
                                    <strong>${util.escapeHtml(a.data.nama)}</strong>
                                </p>
                                <small class="text-dark m-0 p-0" style="font-size: 0.75rem;">${a.data.created_at}</small>
                            </div>
                            <hr class="text-dark my-1">
                            <p class="text-dark m-0 p-0" style="white-space: pre-line">${u(util.escapeHtml(a.data.komentar))}</p>
                        </div>
                    </div>`)}).catch(e=>{m(),alert(`Terdapat kesalahan: ${e}`)}),document.getElementById("ucapan").scrollIntoView({behavior:"smooth"}),a.disabled=!1,a.innerText=s},$=e=>`
        <div class="d-flex flex-wrap justify-content-between align-items-center">
            <div class="d-flex flex-wrap justify-content-start align-items-center">
                <button style="font-size: 0.8rem;" onclick="comment.balasan(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-dark rounded-3 py-0">Balas</button>
                ${d.has(e.uuid)?`
                <button style="font-size: 0.8rem;" onclick="comment.edit(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-dark rounded-3 py-0 ms-1">Ubah</button>
                <button style="font-size: 0.8rem;" onclick="comment.hapus(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-dark rounded-3 py-0 ms-1">Hapus</button>`:""}
            </div>
            <button style="font-size: 0.8rem;" onclick="like.like(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-dark rounded-2 py-0 px-0">
                <div class="d-flex justify-content-start align-items-center">
                    <p class="my-0 mx-1" data-suka="${e.like.love}">${e.like.love} suka</p>
                    <i class="py-1 me-1 p-0 ${r.has(e.uuid)?"fa-solid fa-heart text-danger":"fa-regular fa-heart"}"></i>
                </div>
            </button>
        </div>
        ${y(e.comments)}`,y=e=>{let t="";return e.forEach(e=>{t+=`
            <div class="card-body border-start bg-light py-2 ps-2 pe-0 my-2 ms-2 me-0" id="${e.uuid}">
                <div class="d-flex flex-wrap justify-content-between align-items-center">
                    <p class="text-dark text-truncate m-0 p-0" style="font-size: 0.95rem;">
                        <strong>${util.escapeHtml(e.nama)}</strong>
                    </p>
                    <small class="text-dark m-0 p-0" style="font-size: 0.75rem;">${e.created_at}</small>
                </div>
                <hr class="text-dark my-1">
                <p class="text-dark mt-0 mb-1 mx-0 p-0" style="white-space: pre-line">${u(util.escapeHtml(e.komentar))}</p>
                ${$(e)}
            </div>`}),t},b=e=>{let t=document.createElement("div");return t.classList.add("mb-3"),t.innerHTML=`
        <div class="card-body bg-light shadow p-3 m-0 rounded-4" data-parent="true" id="${e.uuid}">
            <div class="d-flex flex-wrap justify-content-between align-items-center">
                <p class="text-dark text-truncate m-0 p-0" style="font-size: 0.95rem;">
                    <strong class="me-1">${util.escapeHtml(e.nama)}</strong><i class="fa-solid ${e.hadir?"fa-circle-check text-success":"fa-circle-xmark text-danger"}"></i>
                </p>
                <small class="text-dark m-0 p-0" style="font-size: 0.75rem;">${e.created_at}</small>
            </div>
            <hr class="text-dark my-1">
            <p class="text-dark mt-0 mb-1 mx-0 p-0" style="white-space: pre-line">${u(util.escapeHtml(e.komentar))}</p>
            ${$(e)}
        </div>`,t},h=async()=>{let e=document.getElementById("daftar-ucapan");e.innerHTML=k(pagination.getPer());let t=localStorage.getItem("token")??"";if(0==t.length){alert("Terdapat kesalahan, token kosong !"),window.location.reload();return}await request("GET",`/api/comment?per=${pagination.getPer()}&next=${pagination.getNext()}`).token(t).then(t=>{200==t.code&&(e.innerHTML=null,t.data.forEach(t=>e.appendChild(b(t))),pagination.setResultData(t.data.length),0==t.data.length&&(e.innerHTML='<div class="h6 text-center">Tidak ada data</div>'))}).catch(e=>alert(`Terdapat kesalahan: ${e}`))},k=e=>{let t="";for(let a=0;a<e;a++)t+=`
            <div class="mb-3">
                <div class="card-body bg-light shadow p-3 m-0 rounded-4">
                    <div class="d-flex flex-wrap justify-content-between align-items-center placeholder-glow">
                        <span class="placeholder bg-secondary col-5"></span>
                        <span class="placeholder bg-secondary col-3"></span>
                    </div>
                    <hr class="text-dark my-1">
                    <p class="card-text placeholder-glow">
                        <span class="placeholder bg-secondary col-6"></span>
                        <span class="placeholder bg-secondary col-5"></span>
                        <span class="placeholder bg-secondary col-12"></span>
                    </p>
                </div>
            </div>`;return t},f=async()=>{let a=s.value,n=i.value,l=localStorage.getItem("token")??"",r=document.getElementById("id-balasan").getAttribute("data-uuid");if(0==l.length){alert("Terdapat kesalahan, token kosong !"),window.location.reload();return}if(0==a.length){alert("nama tidak boleh kosong");return}if(a.length>=35){alert("panjangan nama maksimal 35");return}if(0==n.length){alert("pesan tidak boleh kosong");return}s.disabled=!0,i.disabled=!0,e.disabled=!0,t.disabled=!0;let c=t.innerHTML;t.innerHTML=o;let u=!1;await request("POST","/api/comment").token(l).body({nama:a,id:r,komentar:n}).then(e=>{201==e.code&&(u=!0,d.set(e.data.uuid,e.data.own))}).catch(e=>{alert(`Terdapat kesalahan: ${e}`)}),u&&(await h(),document.getElementById(r).scrollIntoView({behavior:"smooth",block:"center"}),m()),e.disabled=!1,t.disabled=!1,t.innerHTML=c,s.disabled=!1,i.disabled=!1},_=async()=>{let t=localStorage.getItem("token")??"",n=a.getAttribute("data-uuid"),s=l.value,r=i.value;if(0==t.length){alert("Terdapat kesalahan, token kosong !"),window.location.reload();return}if("true"===document.getElementById(n).getAttribute("data-parent")&&0==s){alert("silahkan pilih kehadiran");return}if(0==r.length){alert("pesan tidak boleh kosong");return}l.disabled=!0,i.disabled=!0,a.disabled=!0,e.disabled=!0;let c=a.innerHTML;a.innerHTML=o;let u=!1;await request("PUT","/api/comment/"+d.get(n)).body({hadir:1==parseInt(s),komentar:r}).token(t).then(e=>{e.data.status&&(u=!0)}).catch(e=>{alert(`Terdapat kesalahan: ${e}`)}),u&&(await h(),document.getElementById(n).scrollIntoView({behavior:"smooth",block:"center"}),m()),a.innerHTML=c,a.disabled=!1,e.disabled=!1,l.disabled=!1,i.disabled=!1},T=async e=>{if(!confirm("Kamu yakin ingin menghapus?"))return;let t=localStorage.getItem("token")??"",a=e.getAttribute("data-uuid");if(0==t.length){alert("Terdapat kesalahan, token kosong !"),window.location.reload();return}m(),e.disabled=!0;let n=e.innerText;e.innerText="Loading..",await request("DELETE","/api/comment/"+d.get(a)).token(t).then(e=>{e.data.status&&(d.unset(a),document.getElementById(a).remove())}).catch(e=>{alert(`Terdapat kesalahan: ${e}`)}),e.innerText=n,e.disabled=!1},x=async t=>{m(),t.disabled=!0;let d=t.innerText;t.innerText="Loading...";let r=t.getAttribute("data-uuid").toString(),o=localStorage.getItem("token")??"";if(0==o.length){alert("Terdapat kesalahan, token kosong !"),window.location.reload();return}await request("GET","/api/comment/"+r).token(o).then(t=>{200==t.code&&(c=r,e.style.display="block",a.style.display="block",n.style.display="none",a.setAttribute("data-uuid",r),i.value=t.data.komentar,s.value=t.data.nama,s.disabled=!0,"true"!==document.getElementById(r).getAttribute("data-parent")?(document.getElementById("label-kehadiran").style.display="none",l.style.display="none"):(l.value=t.data.hadir?1:2,document.getElementById("label-kehadiran").style.display="block",l.style.display="block"),document.getElementById("ucapan").scrollIntoView({behavior:"smooth"}))}).catch(e=>{alert(`Terdapat kesalahan: ${e}`)}),t.disabled=!1,t.innerText=d},w=()=>{c&&(document.getElementById(c).scrollIntoView({behavior:"smooth",block:"center"}),c=null),m()};return{ucapan:h,renderLoading:k,balasan:g,hapus:T,edit:x,batal:w,balas:f,ubah:_,kirim:p}})();